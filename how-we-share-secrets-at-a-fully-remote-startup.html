<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How we share secrets at a fully-remote startup</title><meta name="description" content="Here’s the situation: a small, fully-remote software team works on a service (let’s say Grist), and to run it, they need a secret key..."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="stylesheet" href="https://mill.plainopen.com/media/plugins/syntaxHighlighter/prism-black.css"><link rel="canonical" href="https://mill.plainopen.com/how-we-share-secrets-at-a-fully-remote-startup.html"><link rel="alternate" type="application/atom+xml" href="https://mill.plainopen.com/feed.xml"><link rel="alternate" type="application/json" href="https://mill.plainopen.com/feed.json"><meta property="og:title" content="How we share secrets at a fully-remote startup"><meta property="og:site_name" content="The Mill"><meta property="og:description" content="Here’s the situation: a small, fully-remote software team works on a service (let’s say Grist), and to run it, they need a secret key..."><meta property="og:url" content="https://mill.plainopen.com/how-we-share-secrets-at-a-fully-remote-startup.html"><meta property="og:type" content="article"><link rel="preload" href="https://mill.plainopen.com/assets/dynamic/fonts/lora/lora.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://mill.plainopen.com/assets/dynamic/fonts/lora/lora-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://mill.plainopen.com/assets/css/style.css?v=f0a2027f20f8313aca5b19cca4835a56"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://mill.plainopen.com/how-we-share-secrets-at-a-fully-remote-startup.html"},"headline":"How we share secrets at a fully-remote startup","datePublished":"2025-01-29T00:47-05:00","dateModified":"2025-02-02T00:07-05:00","description":"Here’s the situation: a small, fully-remote software team works on a service (let’s say Grist), and to run it, they need a secret key...","author":{"@type":"Person","name":"Dmitry Sagalovskiy","url":"https://mill.plainopen.com/authors/dmitry/"},"publisher":{"@type":"Organization","name":"Dmitry Sagalovskiy"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://mill.plainopen.com/">The Mill</a></header><main class="post"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>How we share secrets at a fully-remote startup</h1><div class="feed__meta content__meta"><img src="https://mill.plainopen.com/media/website/dmitry_med-copy.jpg" loading="eager" height="1230" width="1230" class="feed__author-thumb" alt=""> <a href="https://mill.plainopen.com/authors/dmitry/" class="feed__author">Dmitry Sagalovskiy</a> <time datetime="2025-01-29T00:47" class="feed__date">2025-01-29 </time>&nbsp; @ &nbsp; <a href="https://mill.plainopen.com/">The Mill</a></div></div></header></div><div class="entry-wrapper content__entry"><p class="msg--highlight msg msg--info">Appeared originally at <a href="https://www.getgrist.com/blog/how-we-share-secrets-at-a-fully-remote-startup/">https://www.getgrist.com/blog/how-we-share-secrets-at-a-fully-remote-startup/</a> on 2024-07-16.</p><p>Here’s the situation: a small, fully-remote software team works on a service (let’s say <a href="https://www.getgrist.com/">Grist</a>), and to run it, they need a secret key (let’s say an API key for OpenAI<sup><a href="#footnote_1">(1)</a></sup>).</p><p>I, the co-CEO, signed up for the OpenAI account and generated an API key. Now I want to share it with my CTO, who is in charge of getting the feature out to production.</p><p>We work remotely. We talk on Slack, or <a href="https://www.kumospace.com/">Kumospace</a>, or Zoom, or even email. Do I want the secret in any of these channels? Nope.</p><p>I like to think of myself as security conscious: careful about privacy, passwords, encryption. (Please don’t take that as an invitation to target me for hacking.) And on a few occasions — enough for this to feel like it’s becoming a theme — I’ve <em><a href="https://security.stackexchange.com/questions/18197/why-shouldnt-we-roll-our-own" target="_blank" rel="noopener noreferrer">rolled my own security</a></em>. Sort of.</p><h4>Don’t roll your own security</h4><p>Like many hard areas of human knowledge, security/cryptography is one where the more you know, the more you realize you don’t know.</p><p>I am not a security expert. But once upon a time, I did take a graduate level Randomized Algorithms class, which was mostly on cryptographic algorithms, from <a href="https://en.wikipedia.org/wiki/Michael_O._Rabin">Michael Rabin</a> — one of the pioneers of public-key cryptography. Another class was a graduate level seminar on Elliptic Curves (the math behind <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography">Elliptic-curve cryptography</a>). Not that I remember much of either – I’m brandishing these credentials to give you at least a bit of confidence that I do in fact realize how much I don’t know.</p><p>Both security and cryptography are easier to mess up than to get right. If you mess up any part, everything breaks. And broken security is worse than useless, it’s dangerous. You’ll be <em>less</em> safe relying on it than if you didn’t rely on it at all. Don’t roll your own!</p><h4>Encrypting secrets</h4><p>And with that in mind, let’s move towards breaking this advice.</p><p>Are there clever tools built to share secrets in a completely encrypted safe way? Yes, there are.<sup><a href="#footnote_2">(2)</a></sup> But we are not <a href="https://scoop4c.eu/cases/estonian-public-key-infrastructure">in Estonia</a>, and to rely on a tool, I’d have to trust it. Is that really different from just trusting Slack?</p><p>So I scratched my head, and decided that there are some tools I do trust already. I trust my computer, and my CTO’s computer, mostly because I have to. The task would be impossible if I didn’t. And I trust low-level tools already installed on our computers. One of them is <a href="https://nodejs.org/">Node.js</a>. Node.js is JavaScript for the server, and runs happily from the command line in a terminal.</p><p>So I asked myself: if I just limit my trust to Node.js, is that enough to share a secret?</p><p>Yes! But I need a bit of software — some JavaScript code — that would run in Node.js to encrypt/decrypt my secret. I could look for something to download, or I could write my own. Either way, if I don’t want to trust it, I want to be able to read and understand it. Luckily, what Node.js has built-in (and what I’ve already decided I will trust) is enough that the extra code is small.</p><p>I wrote a small JS script run using Node.js from a terminal. Initially it was 46 lines, though now it’s 72 with support for larger secrets. <a href="https://github.com/gristlabs/secrets.js/blob/main/secrets.js">It’s also on GitHub</a>. You can read it and understand it.</p><figure class="post__image post__image--center"><figure class="post__image"><img loading="lazy" src="https://mill.plainopen.com/media/posts/3/code-3.png" alt="Full code of the script" width="366" height="696" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://mill.plainopen.com/media/posts/3/responsive/code-3-xs.png 640w, https://mill.plainopen.com/media/posts/3/responsive/code-3-sm.png 768w, https://mill.plainopen.com/media/posts/3/responsive/code-3-md.png 1024w, https://mill.plainopen.com/media/posts/3/responsive/code-3-lg.png 1366w, https://mill.plainopen.com/media/posts/3/responsive/code-3-xl.png 1600w, https://mill.plainopen.com/media/posts/3/responsive/code-3-2xl.png 1920w"></figure><figcaption>Pictured: all the code</figcaption></figure><h4>Let’s walk through it</h4><ol><li>The main workhorse is the Node <a href="https://nodejs.org/api/crypto.html">crypto</a> module. So no, I didn’t roll my own cryptography.</li><li>Then we have the <code>main()</code> function. When run with no arguments in a terminal, it helpfully prints out all available commands:<pre class="language-bash"><code>$ ./secrets.js
Usage:
      ./secrets.js encrypt RECIPIENT_KEYFILE.pub &lt; PLAINTEXT_FILE
      ./secrets.js decrypt MY_KEYFILE.priv &lt; ENCRYPTED_FILE
      ./secrets.js genkey MY_KEYFILE</code></pre></li><li>Continuing with <code>main()</code>, we check if the command is <code>encrypt</code>. If so, read the public key and the plaintext file.</li><li>Encryption is almost fully provided by the <code>crypto</code> module:<pre class="language-javascript"><code>crypto.publicEncrypt({key, padding}, plaintext).toString('base64')</code></pre>We just have to pick the parameters (<code>padding</code>), and encode the result into text that’s easy to copy/paste.</li><li>But life isn’t so simple. This only works for very small inputs (OK for a short API key, not enough for an SSL certificate). If the input is too large, we do the typical thing public-key cryptography does:<ol><li>Generate a small key for symmetric encryption on the fly.</li><li>Encrypt the long input using that key.</li><li>Put together the symmetric key (encrypted using the recipient’s public key) and the input (encrypted with the symmetric key). You can see how having the recipient’s private key would unlock the symmetric key, which would in turn unlock the data.</li></ol></li><li>Now we’re getting dangerously close to rolling our own, even though this logic is just 7 lines of code. There are more parameters (size of symmetric key, symmetric encryption algorithm, initialization vector), and there’s the question of whether our approach is right. There are multiple options that would work fine, but it’s possible to get it wrong, which would be worse than skipping the project altogether. I won’t lie: the parameters are not obvious, or even well-documented (either in Node’s <code>crypto</code>, or in OpenSSL that it uses under the hood). I did research on this, however, and recommend you do your own if you have doubts.</li><li>Continuing with <code>main()</code>, it then handles the <code>decrypt</code> command. It does all the steps of <code>encrypt</code> in reverse.</li><li>The last bit is the <code>genkey</code> command for creating the key-pair: <code>crypto</code> once again provides the <code>generateKeyPair</code> function for that. We just pick suitable parameters to call it with. We save the files containing the public and private keys, and reduce permissions on the private key to make it readable only by you.</li></ol><p>That’s it! Public-key cryptography for this simple use case:</p><ol><li>The recipient generates a key-pair (<code>genkey</code>), holds on to the private key, and shares freely the public key. The keys are just files on your computer.</li><li>The sender uses the recipient’s public key (<code>RECIPIENT_KEYFILE.pub</code> above) to encrypt a secret (“plaintext” in crypto-speak). The encrypted block of text (ciphertext) is safe to share over an untrusted channel.</li><li>The recipient uses their private key (<code>MY_KEYFILE.priv</code> above) to decrypt it. No one else has the private key, and no one can decrypt the ciphertext without it.</li></ol><figure class="post__image post__image--center"><figure class="post__image"><img loading="lazy" src="https://mill.plainopen.com/media/posts/3/sisyphus-2.jpeg" alt="Sisiphus being crushed by his stone" width="600" height="395" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-xs.jpeg 640w, https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-sm.jpeg 768w, https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-md.jpeg 1024w, https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-lg.jpeg 1366w, https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-xl.jpeg 1600w, https://mill.plainopen.com/media/posts/3/responsive/sisyphus-2-2xl.jpeg 1920w"></figure><figcaption><span style="color: #34495e;">Sisyphus “rolling his own”.</span> <span style="color: #7e8c8d;">(Image source: <a href="https://commons.wikimedia.org/wiki/File:Sisyphus_-_Le_Roman_de_la_Rose.jpeg" target="_blank" rel="noreferrer noopener" style="color: #7e8c8d;">Wikimedia Commons</a>)</span></figcaption></figure><h4>Did we roll our own security?</h4><p>Not entirely. Our solution uses and trusts a lot of cryptography code from good sources: Node.js, its <code>crypto</code> module, and the <a href="https://www.openssl.org/">OpenSSL</a> library it’s based on. These are respected, well-maintained, commonly-used open-source tools, which get plenty of attention from security researchers.</p><p>The code we did write, which makes a number of choices about <em>how</em> this cryptography is used, is still sensitive security code. That’s risky. The main protection here is that it’s so small that any software engineer can read and understand it. To me what matters is that <em>I</em> can read and understand it.</p><p>I find this an interesting compromise. It feels as secure as I can imagine any software to be, and it allows Grist Labs to share technical secrets remotely. For non-technical secrets (like next month’s book club selection), Slack works fine. For now…</p><hr><div class="footnote"><p id="footnote_1">(1) We use <a href="https://platform.openai.com/">OpenAI</a> for Grist’s <a href="https://www.getgrist.com/ai-formula-assistant/">AI Formula Assistant</a>, but without sending data from your document, only its structure.</p><p id="footnote_2">(2) There are plenty of <a href="https://www.reddit.com/r/devops/comments/tofkfs/how_do_you_send_secrets_to_other_people/" target="_blank" rel="noreferrer noopener">other opinions on this problem</a>. But there’s also this (paraphrased) conversation I had with a colleague after showing them a draft of this post, which brings us back full circle:</p><p><em style="color: var(--text-primary-color); font-family: var(--editor-font-family); font-size: inherit; font-weight: var(--font-weight-normal);">“If we’re bothering with encryption and keypairs, why not just PGP?”</em></p><p><em style="color: var(--text-primary-color); font-family: var(--editor-font-family); font-size: inherit; font-weight: var(--font-weight-normal);">“That’s still software I have to trust and install. In fact, I just tried, and got lost immediately. I found OpenPGP which has a half-dozen email-related packages for MacOS (didn’t try: proprietary/paid, and all about specific email clients that I don’t need), and found GPG which has two installers for Mac. I tried one, and it needs root access to install itself. Why would I give some software root access just to encrypt a secret? It certainly doesn’t increase my trust in it.”</em></p><p><em style="color: var(--text-primary-color); font-family: var(--editor-font-family); font-size: inherit; font-weight: var(--font-weight-normal);">“I guess what this answer points out, once again, is that GPG has a usability problem… So bad that it’s easier to create a short script in Node.js to do one of its core features.”</em></p></div></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on 2025-02-02</p><div class="content__actions"><ul class="content__tag"><li><a href="https://mill.plainopen.com/tags/algorithms/">algorithms</a></li><li><a href="https://mill.plainopen.com/tags/cryptography/">cryptography</a></li><li><a href="https://mill.plainopen.com/tags/javascript/">javascript</a></li><li><a href="https://mill.plainopen.com/tags/security/">security</a></li><li><a href="https://mill.plainopen.com/tags/startups/">startups</a></li></ul><div class="content__share"><button class="btn--icon content__share-button js-content__share-button"><svg width="20" height="20" aria-hidden="true"><use xlink:href="https://mill.plainopen.com/assets/svg/svg-map.svg#share"></use></svg> <span>Share It</span></button><div class="content__share-popup js-content__share-popup"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmill.plainopen.com%2Fhow-we-share-secrets-at-a-fully-remote-startup.html" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://mill.plainopen.com/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div></div></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-prev"><a href="https://mill.plainopen.com/why-sorting-is-harder-than-it-seems.html" class="content__nav-link" rel="prev"><div><span>Previous</span> Why sorting is harder than it seems</div></a></div></div></div></nav></footer></article><div class="banner banner--after-content"><div class="wrapper"><script src="https://giscus.app/client.js" data-repo="dsagal/plainopen-mill-blog" data-repo-id="R_kgDONwenRg" data-category="Announcements" data-category-id="DIC_kwDONwenRs4CmbOd" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async></script><div id="giscus-alternative" style="display: none">Instead of signing in here, you can comment directly <a href="" id="giscus-discussion-link">on GitHub</a>.</div><script>window.addEventListener('message', event => {
    if (event.origin !== 'https://giscus.app') { return; }
    const discussionUrl = event.data?.giscus?.discussion?.url;
    if (!discussionUrl) { return; }
    const altElem = document.querySelector('#giscus-alternative');
    const linkElem = document.querySelector('#giscus-discussion-link');
    if (!altElem || !linkElem) { return; }
    linkElem.href = discussionUrl;
    altElem.style.display = '';
});</script></div></div></main><footer class="footer footer--glued"><div class="wrapper"><div class="footer__copyright"><p>© 2025 The Mill — <a href="https://github.com/dsagal/">GitHub</a> — <a href="https://www.linkedin.com/in/dsagal/">LinkedIn</a></p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://mill.plainopen.com/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://mill.plainopen.com/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://mill.plainopen.com/media/plugins/syntaxHighlighter/prism.js"></script></body></html>